<!DOCTYPE html>
<html lang="{{ page.lang | default: site.lang | default: "en" }}">

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    {%- seo -%}
    <link rel="stylesheet" href="{{ "/assets/main.css" | relative_url }}">
    {%- feed_meta -%}
  </head>

  <body>

    <header role="banner">

    <ul>
      <li><a href="{{ site.baseurl }}/home">The Hoosac Institute</a></li>
      <li><a href="{{ site.baseurl }}/about">About</a></li>
      <li><a href="{{ site.baseurl }}/journal">Journal</a></li>
    </ul>

    </header>
    <main id="barba-wrapper">
      <div class="barba-container" aria-label="Content">
          {{ content }}
      </div>
    </main>

    <footer>
    </footer>
    <script src="https://unpkg.com/tippy.js@2.5.2/dist/tippy.all.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/barba.js/1.0.0/barba.min.js"></script>
    <script>
      tippy('a', {
        followCursor: true,
        animateFill: false,
        duration: 0,
        placement: 'right'
      })
    </script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
      var lastElementClicked;
      var PrevLink = document.querySelector('a');
      var NextLink = document.querySelector('a');

      Barba.Pjax.init();
      Barba.Prefetch.init();

      Barba.Dispatcher.on('linkClicked', function(el) {
        lastElementClicked = el;
      });

      var MovePage = Barba.BaseTransition.extend({
        start: function() {
          this.originalThumb = lastElementClicked;

          Promise
            .all([this.newContainerLoading, this.scrollTop()])
            .then(this.movePages.bind(this));
        },

        scrollTop: function() {
          var deferred = Barba.Utils.deferred();
          var obj = { y: window.pageYOffset };

          TweenLite.to(obj, 0.4, {
            y: 0,
            onUpdate: function() {
              if (obj.y === 0) {
                deferred.resolve();
              }

              window.scroll(0, obj.y);
            },
            onComplete: function() {
              deferred.resolve();
            }
          });

          return deferred.promise;
        },

        movePages: function() {
          var _this = this;
          var goingForward = true;
          this.updateLinks();

          if (this.getNewPageFile() === this.oldContainer.dataset.prev) {
            goingForward = false;
          }

          TweenLite.set(this.newContainer, {
            visibility: 'visible',
            xPercent: goingForward ? 100 : -100,
            position: 'fixed',
            left: 0,
            top: 0,
            right: 0
          });

          TweenLite.to(this.oldContainer, 0.6, { xPercent: goingForward ? -100 : 100 });
          TweenLite.to(this.newContainer, 0.6, { xPercent: 0, onComplete: function() {
            TweenLite.set(_this.newContainer, { clearProps: 'all' });
            _this.done();
          }});
        },

        updateLinks: function() {
          PrevLink.href = this.newContainer.dataset.prev;
          NextLink.href = this.newContainer.dataset.next;
        },

        getNewPageFile: function() {
          return Barba.HistoryManager.currentStatus().url.split('/').pop();
        }
      });

      Barba.Pjax.getTransition = function() {
        return MovePage;
      };
    });

    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.18.1/TweenMax.min.js"></script>
  </body>

</html>
